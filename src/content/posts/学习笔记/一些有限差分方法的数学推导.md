---
title: 向前欧拉、向后欧拉、跃点（蛙跳）、梯形四种有限差分方法的准确性（收敛性）、稳定性数学推导
slug: derivations-of-some-finite-difference-methods
description: 对向前欧拉、向后欧拉、跃点(Leap frog)、梯形四种有限差分格式的准确性、稳定性进行数学推导，并给出数值计算结果。
cover: https://bu.dusays.com/2024/10/28/671f2b1c2710f.webp
category: 学习笔记
tags:
  - 数学
published: 2024-08-19T20:55:30+08:00
---

> [!NOTE]
> 本文由以前的课程论文使用 [pandoc](https://pandoc.org/) 转换到 markdown 博客，原文为本人厦门大学数学系课程《微分方程数值解》的课程论文，参考时请注意。

## 简介

本文默认读者对有限差分方法有一定了解，因此不做过多的前置知识介绍。

考虑如下初值问题:

$$
 \begin{cases} u ^ { \prime } = f ( t , u ) , \\\\ u ( 0 ) = u ^ {(0)}, \end{cases} \quad t \in \left[ 0 , T \right],
$$

将 $[0, T]$ 划分为 $M$ 个等距区间，$h = T/M$，我们有以下几种有限差分格式用于求其数值解:

- 向前欧拉格式

$$
 u^{(n+1)} = u^{(n)} + hf(t^{(n)},u^{(n)}).
$$

- 向后欧拉格式

$$
 u^{(n+1)} = u^{(n)} + hf(t^{(n+1)},u^{(n+1)}).
$$

- 跃点(Leap frog)格式

$$
 u^{(n+1)} = u^{(n-1)} + 2hf(t^{(n)},u^{(n)}).
$$

- 梯形格式

$$
 u^{(n+1)} = u^{(n)} + h \frac{f(t^{(n)},u^{(n)}) + f(t^{(n+1)},u^{(n+1)})}{2}.
$$

接下来，对以上四种有限差分格式，我们将进行其准确性(Accuracy)与稳定性(Stability)的数学推导。

## 准确性推导

首先定义局部截断误差(Local Truncation Error) $R^{(n)}$，其定义为：
其他点处的精确解在 $t^{(n)}$ 处按照差分格式计算得到的结果与 $t^{(n)}$ 处的精确解的差值。

> [!WARNING]
> 上述局部截断误差与通常定义的局部截断误差相差一个 $h$，参考时请注意。

### 向前欧拉格式

向前欧拉格式的局部截断误差 $R^{(n)}$ 可表示为如下等式

$$
 R ^ { (n) } = \frac {u ( t ^ {( n + 1) } ) - u ( t ^ { (n) } )}{h} - u' ( t ^ { (n) } ).
$$

对 $u(t^{(n+1)})$ 进行 Taylor 展开有

$$
 u ( t ^ { (n + 1) } ) = u ( t ^ { (n) } ) + h u ^ { \prime } ( t ^ { (n) } ) + \frac { h ^ { 2 } } { 2 } u ^ { \prime \prime } ( \xi ^ { (n) } ) , \xi ^ { (n) } \in \left[ t ^ { (n) } , t ^ { (n + 1) } \right] .
$$

于是有

$$
 R ^ { (n) } = \frac { h } { 2 } u ^ { \prime \prime } ( \xi ^ { (n) } ) = O ( h ) , \xi^{(n)} \in \left[ t ^ { (n) } , t ^ { (n + 1) } \right].
$$

误差 $E^{(n)}$ 可表示为如下形式：

$$
 \frac { E^{ (n + 1) } - E^{ (n) } } { h } + R ^ { (n) } = f ( t ^ { (n) } , u ( t ^ { (n) } ) ) - f ( t ^ { (n) } , u ^ { (n) } ) .
$$

令 $R = \max_n |{R^{(n)}}|$，对误差 $E^{(n)}$ 有如下估计：

$$
 \begin{aligned} \left|E^{(n+1)}\right| &\leq \left| { E^{(n)} } \right| + h R + h L \left| { u ( t^{(n)} ) - u^{(n)} } \right| = ( 1 + h L ) | E^{(n)} | + h R \\\\ &\leq ( 1 + h L ) ^ { n + 1 } | E^{(0)} | + \frac { R } { L } \left( \left( 1 + h L \right) ^ { n + 1 } - 1 \right) \\\\ &\leq e^{LT} | E^{(0)} | + \frac { R } { L } ( e^{LT} - 1 ) \leq O ( h ) , n = 0 , 1 , \cdots , M - 1 . \end{aligned}
$$

### 向后欧拉格式

向后欧拉格式的局部截断误差 $R^{(n)}$ 可表示为如下等式

$$
 R ^ { (n) } = \frac {u ( t ^ {( n) } ) - u ( t ^ { (n-1) } )}{h} - u' ( t ^ { (n) } ).
$$

对 $u(t^{(n-1)})$ 进行 Taylor 展开有

$$
 u ( t ^ { (n - 1) } ) = u ( t ^ { (n) } ) - h u ^ { \prime } ( t ^ { (n) } ) + \frac { h ^ { 2 } } { 2 } u ^ { \prime \prime } ( \xi ^ { (n) } ) , \xi ^ { (n) } \in \left[ t ^ { (n-1) } , t ^ { (n) } \right] .
$$

于是有

$$
 R ^ { (n) } = -\frac { h } { 2 } u ^ { \prime \prime } ( \xi ^ { (n) } ) = O ( h ) , \xi^{(n)} \in \left[ t ^ { (n-1) } , t ^ { (n) } \right].
$$

误差 $E^{(n)}$ 可表示为如下形式：

$$
 \frac { E^{ (n) } - E^{ (n-1) } } { h } - R ^ { (n) } = f ( t ^ { (n) } , u ( t ^ { (n) } ) ) - f ( t ^ { (n) } , u ^ { (n) } ) .
$$

令 $R = \max_n |{R^{(n)}}|$，假定 $hL<1$，对误差 $E^{(n)}$ 有如下估计：

$$
 \begin{aligned} | E^{(n)} | &\leq ( 1 - h L ) ^ { - 1 } | E^{(n-1)} | + h R \leq ( 1 - h L ) ^ { - n } | E^{(0)} | + \frac { R } { L } ( 1 - h L ) ( \left( 1 - h L \right) ^ { - n } - 1 ) \\\\ &< \left( 1 + \frac { h L } { 1 - h L } \right) ^ { n } | E^{ (0) } | + \frac { R } { L } \left( \left( 1 + \frac { h L } { 1 - h L } \right) ^ { n } - 1 \right) \\\\ &\leq \exp \left( \frac { L T } { 1 - h L } \right) | E^{(0)} | + \frac { R } { L } \left( \exp \left( \frac { L T } { 1 - h L } \right) - 1 \right) \leq O ( h ) , n = 1 , 2 , 3 , \cdots , M . \end{aligned}
$$

### 跃点格式

跃点格式的局部截断误差 $R^{(n)}$ 可表示为如下等式

$$
 R ^ { (n) } = \frac {u ( t ^ {(n+1) } ) - u ( t ^ { (n-1) } )}{2h} - u' ( t ^ { (n) } ).
$$

对 $u(t^{(n-1)})$ 和 $u(t^{(n+1)})$ 进行 Taylor 展开有

$$
 u ( t ^ { (n - 1) } ) = u ( t ^ { (n) } ) - h u ^ { \prime } ( t ^ { (n) } ) + \frac { h ^ { 2 } } { 2 } u ^ { \prime \prime } ( \xi_1 ^ { (n) } ) , \xi_1 ^ { (n) } \in \left[ t ^ { (n-1) } , t ^ { (n) } \right] .
$$

$$
 u ( t ^ { (n + 1) } ) = u ( t ^ { (n) } ) + h u ^ { \prime } ( t ^ { (n) } ) + \frac { h ^ { 2 } } { 2 } u ^ { \prime \prime } ( \xi_2 ^ { (n) } ) , \xi_2 ^ { (n) } \in \left[ t ^ { (n) } , t ^ { (n + 1) } \right] .
$$

于是有

$$
 R ^ { (n) } = \frac { h } { 4 } \left(u ^ { \prime \prime } ( \xi_1 ^ { (n) } ) + u ^ { \prime \prime } ( \xi_2 ^ { (n) } )\right) = O ( h ) , \xi_1 ^ { n } \in \left[ t ^ { (n) } , t ^ { (n + 1) } \right], \xi_2 ^ { (n) } \in \left[ t ^ { (n) } , t ^ { (n+1) } \right].
$$

误差 $E^{(n)}$ 可表示为如下形式：

$$
 \frac { E^{ (n+1) } - E^{ (n-1) } } { 2h } - R ^ { (n) } = f ( t ^ { (n) } , u ( t ^ { (n) } ) ) - f ( t ^ { (n) } , u ^ { (n) } ) .
$$

令 $R = \max_n |{R^{(n)}}|$，对误差 $E^{(n)}$ 有如下估计：

$$
 | E ^ { (n + 1) } | \leq | E ^ { (n - 1) } | + 2 h L | E ^ { (n) } | + 2 h R .
$$

令 $\mu = \sqrt { 1 + h ^ { 2 } L ^ { 2 } } - h L$，$\lambda = \sqrt{1 + h^2 L^2} + hL$，则 $\mu\lambda = 1$，且 $\lambda - \mu = 2hL$. 于是上式可改写为如下形式：

$$
 \begin{aligned} | E ^ { (n + 1) } | + \mu | E ^ { (n) } | &\leq \lambda ( | E ^ { (n) } | + \mu | E ^ { (n - 1) } | ) + 2 h R \leq \cdots \leq \lambda ^ { n } ( | E ^ { (1) } | + \mu | E ^ { (0) } | ) + \frac { \lambda ^ { n } - 1 } { \lambda - 1 } 2 h \\\\ &\leq ( 1 + 2 h L ) ^ { n } ( | E ^ { (1) } | + \mu | E ^ { (0) } | ) + \frac { ( 1 + 2 h L ) ^ { n } - 1 } { \lambda - 1 } 2 h R \\\\ &\leq e ^ { 2 L T } ( | E ^ { (1) } | + \mu | E ^ { (0) } | ) + \frac { e ^ { 2 L T } - 1 } { \lambda - 1 } 2 h R. \end{aligned}
$$

不妨假定上式中的 $E^{(1)} = u(t^{(1)}) - u^{(1)}$ 是由向前欧拉格式得到的，注意到 $h \rightarrow 0$ 时 $h / (\lambda - 1) \rightarrow 1 / L$，于是有

$$
 | E ^ { (n+1) } | \leq | E ^ { (n+1) } | + \mu | E ^ { (n) } | \leq O ( h ) , n = 1 , 2 , 3 , \cdots , M - 1.
$$

### 梯形格式

跃点格式的局部截断误差 $R^{(n)}$ 可表示为如下等式

$$
 R ^ { (n) } = \frac {u ( t ^ {(n+1) } ) - u ( t ^ { (n) } )}{h} - \frac {u' ( t ^ {(n+1) } ) - u' ( t ^ { (n) } )}{2}.
$$

对 $u'(t^{(n+1)})$ 和 $u(t^{(n+1)})$ 进行 Taylor 展开有

$$
 u ( t ^ { (n + 1) } ) = u ( t ^ { (n) } ) + h u ^ { \prime } ( t ^ { (n) } ) + \frac { h ^ { 2 } } { 2 } u ^ { \prime \prime } ( \xi*1 ^ { (n) } ) , \xi_1 ^ { (n) } \in \left[ t ^ { (n) } , t ^ { (n + 1) } \right] ,
$$

$$
 u ^ { \prime } ( t ^ { (n+1) } ) = u ^ { \prime } ( t ^ { (n) } ) + h u ^ { \prime \prime } ( t ^ { (n) } ) + \frac { h ^ { 2 } } { 2 } u ^ { \prime \prime } ( \xi * { 2 } ^ { (n) } ) , \xi _ { 2 } ^ { (n) } \in \left[ t ^ { (n) } , t ^ { (n+1) } \right],
$$

于是有

$$
 R ^ { (n) } = \frac { h ^ { 2 } } { 1 2 } ( 2 u''' ( \xi _ { 1 } ^ { (n) } ) - 3 u''' ( \xi _ { 2 } ^ { (n) } ) ) = O ( h ^ { 2 } ) , \xi _ { 1 } ^ { (n) } \in \left[ t ^ { n } , t ^ { n + 1 } \right] , \xi \_ { 2 } ^ { (n) } \in \left[ t ^ { n } , t ^ { n + 1 } \right].
$$

误差 $E^{(n)}$ 可表示为如下形式：

$$
 \frac { E^{ (n+1) } - E^{ (n-1) } } { h } - R ^ { (n) } = \frac{f ( t ^ { (n+1) } , u ( t ^ { (n+1) } ) ) + f ( t ^ { (n+1) } , u ( t ^ { (n+1) } ) )}{2} - \frac{f ( t ^ { (n) } , u ^ { (n) } ) + f ( t ^ { (n) } , u ^ { (n) } )}{2} .
$$

令 $R = \max_n |{R^{(n)}}|$，假定 $hL<2$，对误差 $E^{(n)}$ 有如下估计：

$$
 | E ^ { (n + 1) } | \leq | E ^ { (n) } | + \frac{h L}{2} (| E ^ { (n+1) } | + | E ^ { (n) } |) + h R .
$$

$$
 \begin{aligned} | E ^ { (n) } | &\leq \frac { 2 + h L } { 2 - h L } | E ^ { (n-1) } | + \frac { 2 h R } { 2 - h L } \leq \frac { \left( 2 + h L \right) ^ { n } } { \left( 2 - h L \right) ^ { n } } | E ^ { (0) } | + \frac { R } { L } \left( \frac { \left( 2 + h L \right) ^ { n } } { \left( 2 - h L \right) ^ { n } } - 1 \right) \\\\ &\leq \exp \left( \frac { 2 L T } { 2 - h L } \right) | E ^ { (0) } | + \frac { R } { L } \left( \exp \left( \frac { 2 L T } { 2 - h L } \right) - 1 \right) \leq O ( h ^ { 2 } ) , n = 1 , 2 , 3 , . . . , M.\end{aligned}
$$

## 稳定性推导

考虑模型问题

$$
 \frac { \text{d} u } { \text{d} t } = \lambda u ,
$$

其中 $\lambda$ 为常数。定义 $\varepsilon^{(n)}$ 为舍入误差，$z = h\lambda$. 我们称差分格式的绝对稳定区域(Absolute Stability Region)为复平面上所有使差分格式的解稳定的 $z$ 的集合。

### 向前欧拉格式

将格式代入模型问题可得

$$
 u ^ { (n + 1) } = ( 1 + h \lambda ) u ^ { (n) } .
$$

考虑到舍入误差，我们有 ${\bar{u}^{(n)}}$ 而非 ${u^{(n)}}$：

$$
 \bar{u} ^ { (n + 1) } = \bar{u}^{(n)} + h \lambda \bar{u}^{(n)} + \varepsilon^{(n)} .
$$

误差 $E^{(n)} :=\bar{u}^{(n)} - u^{(n)}$ 满足

$$
 E ^ { (n+1) } = E ^ { (n) } + h \lambda E ^ { (n) } + \varepsilon ^ { (n) } = \cdots = ( 1 + h \lambda ) ^ { n + 1 } E ^ { (0) } + \left( 1 + h \lambda \right) ^ { n } \varepsilon ^ { (0) } + \cdots + \varepsilon ^ { (n) } .
$$

假设 $\varepsilon^{(n)} < \varepsilon$，若 $|1 + h\lambda| < 1$，则有

$$
 | E ^ { (n + 1) } | \leq | 1 + h \lambda | ^ { n + 1 } | E ^ { (0) } | + \frac { | 1 + h \lambda |^{n+1} + 1 } { | h \lambda | } \varepsilon \rightarrow c \varepsilon .
$$

其中 $c$ 为常数，所以本格式的绝对稳定区域为 $|1+z|<1$.

### 向后欧拉格式

将格式代入模型问题可得

$$
 u ^ { (n) } = ( 1 - h \lambda ) u ^ { (n+1) } .
$$

考虑到舍入误差，我们有 ${\bar{u}^{(n)}}$ 而非 ${u^{(n)}}$：

$$
 \bar{u} ^ { (n + 1) } = \bar{u}^{(n)} + h \lambda \bar{u}^{(n+1)} + \varepsilon^{(n)} .
$$

误差 $E^{(n)} :=\bar{u}^{(n)} - u^{(n)}$ 满足

$$
 \begin{aligned} E ^ { (n+1) } &= E ^ { (n) } + h \lambda E ^ { (n+1) } + \varepsilon ^ { (n) } = = \left( 1 - h \lambda \right) ^ { - 1 } E ^ { (n) } + \left( 1 - h \lambda \right) ^ { - 1 } \varepsilon ^ { (n) } = \cdots \\\\ &= ( 1 - h \lambda ) ^ { - ( n + 1 ) } E ^ { (0) } + ( 1 - h \lambda ) ^ { - ( n + 1 ) } \varepsilon ^ { (0) } + \cdots + ( 1 - h \lambda ) ^ { - 1 } \varepsilon ^ { (n) } .\end{aligned}
$$

假设 $\varepsilon^{ (n) } < \varepsilon$，若 $|1 + h\lambda| > 1$，则有

$$
 | E ^ { (n + 1) } | \leq | 1 - h \lambda | ^ { -(n + 1) } | E ^ { (0) } | + \frac { | 1 - h \lambda |^{-n} + 1 } { | h \lambda | } \varepsilon \rightarrow c \varepsilon .
$$

其中 $c$ 为常数，所以本格式的绝对稳定区域为 $|1-z|>1$.

### 跃点格式

将格式代入模型问题可得

$$
 u ^ { (n+1) } = u ^ { (n-1) } + 2 h \lambda u ^ { (n) }.
$$

考虑到舍入误差，我们有 ${\bar{u}^{(n)}}$ 而非 ${u^{(n)}}$：

$$
\bar{u} ^ { (n + 1) } = \bar{u}^{(n-1)} + 2 h \lambda \bar{u}^{(n)} + \varepsilon^{(n-1)} .
$$

误差 $E^{(n)} :=\bar{u}^{(n)} - u^{(n)}$ 满足

$$
\begin{aligned} E ^ { (n+1) } + \alpha E ^ { (n) } &= \frac { 1 } { \alpha } ( E ^ { (n) } + \alpha E ^ { (n-1) } ) + \varepsilon ^ { (n-1) } = \cdots \\\\
&= \frac { 1 } { \alpha ^ { n } } ( E ^ { (1) } + \alpha E ^ { (0) } ) + \frac { 1 } { \alpha ^ { n - 1 } } \varepsilon ^ { (0) } + \cdots + \varepsilon ^ { (n-1) }, \end{aligned}
$$

其中 $\alpha = ( h ^ { 2 } \lambda ^ { 2 } + 1 ) ^ { 1 / 2 } - h \lambda$，多值函数 $z^{1/2}$ 取将正数映射到正数的解析分支。随后我们有

$$
 \begin{aligned} E ^ { (n+1) } &= \alpha ^ { - n } ( E ^ { (1) } + \alpha E ^ { (0) } ) + \sum _ { k = 0 } ^ { n - 1 } \alpha ^ { k - ( n - 1 ) } \varepsilon ^ { (k) } - \alpha E ^ { (n) } = \cdots \\\\ &= \frac { \left( - 1 \right) ^ { n - 1 } a ^ { n } + a ^ { - n } } { a ^ { 2 } + 1 } ( E ^ { (1) } + \alpha E ^ { (0) } ) + \sum _ { k = 0 } ^ { n - 1 } \frac { ( - 1 ) ^ { n - 1 - k } a ^ { n + 1 - k } + \alpha ^ { k - ( n - 1 ) } } { a ^ { 2 } + 1 } \varepsilon ^ { (k) } + ( - 1 ) ^ { n } \alpha E ^ { (1) } . \end{aligned}
$$

假设 $\varepsilon ^ { (n) } < \varepsilon$，若 $|1 + h\lambda| > 1$，则有

$$
 | E ^ { (n+1) } | \leq \frac { | \alpha | ^ { n } + | \alpha | ^ { - n } } { | \alpha ^ { 2 } + 1 | } | E ^ { (1) } + \alpha E ^ { (0) } | + | \alpha | | E ^ { (1) } | + \frac { | a | } { | \alpha ^ { 2 } + 1 | } \left( \frac { | \alpha ^ { n } + 1 | } { | \alpha ^ { - 1 } + 1 | } + \frac { | \alpha ^ { - n } - 1 | } { | \alpha - 1 | } \right) \varepsilon .
$$

上式同时出现 $|\alpha ^ { n }|$ 与 $|\alpha ^ { - n }|$，所以仅 $|\alpha| = 1$ 时跃点格式稳定。令 $z = a+bi$ 有

$$
 | \alpha | ^ { 2 } = \left( \sqrt { r } \cos { \theta } - a \right) ^ { 2 } + \left( \sqrt { r } \sin { \theta } - b \right) ^ { 2 } = r + a ^ { 2 } + b ^ { 2 } - 2 \sqrt { r } ( a \cos { \theta } + b \sin { \theta } ) = 1 ,
$$

其中

$$
 r = \sqrt { \left( a ^ { 2 } - b ^ { 2 } + 1 \right) ^ { 2 } + 4 a ^ { 2 } b ^ { 2 } } , \theta = \arctan \left( \frac { 2 a b } { a ^ { 2 } - b ^ { 2 } + 1 } \right) \bigg/ 2 .
$$

注意到仅 $a = 0$ 且 $|b| \leq 1$ 时上式成立，所以跃点格式的绝对稳定区域为 $z = bi, b \in [-1,1]$.

### 梯形格式

将格式代入模型问题可得

$$
 u ^ { (n+1) } = u ^ { (n) } + \frac { h \lambda } { 2 } ( u ^ { (n) } + u ^ { (n+1) } ) .
$$

考虑到舍入误差，我们有 ${\bar{u}^{(n)}}$ 而非 ${u^{(n)}}$：

$$
 \tilde { u } ^ { (n+1) } = \overline { u } ^ { (n) } + \frac { h \lambda } { 2 } \overline { u } ^ { (n) } + \frac { h \lambda } { 2 } \overline { u } ^ { (n+1) } + \varepsilon ^ { (n) } .
$$

误差 $E^{(n)} :=\bar{u}^{(n)} - u^{(n)}$ 满足

$$
 \begin{aligned} e ^ { n + 1 } &= e ^ { n } + \frac { h \lambda } { 2 } e ^ { n } + \frac { h \lambda } { 2 } e ^ { n + 1 } + \varepsilon ^ { n } = \frac { 2 + h \lambda } { 2 - h \lambda } e ^ { n } + \frac { 2 } { 2 - h \lambda } \varepsilon ^ { n } = \cdots\\\\ &= \frac { ( 2 + h \lambda ) ^ { n + 1 } } { ( 2 - h \lambda ) ^ { n + 1 } } e ^ { 0 } + \frac { \left( 2 + h \lambda \right) ^ { n } } { \left( 2 - h \lambda \right) ^ { n + 1 } } 2 \varepsilon ^ { 0 } + \cdots + \frac { 2 } { 2 - h \lambda } \varepsilon ^ { n } . \end{aligned}
$$

假设 $\varepsilon ^ { (n) } < \varepsilon$，令 $z = a+bi$，若 $a<0$，则有

$$
 | e ^ { n + 1 } | \leq \frac { | 2 + h \lambda | ^ { n + 1 } } { | 2 - h \lambda | ^ { n + 1 } } | e ^ { 0 } | + \left( \frac { | 2 + h \lambda | ^ { n + 1 } } { | 2 - h \lambda | ^ { n + 1 } } - 1 \right) \rightarrow c \varepsilon ,
$$

其中 $c$ 为常数，所以本格式的绝对稳定区域为 $\text{Re}(z) <0$.

## 数值试验

:::collapse{title="四种有限差分格式的MATLAB代码"}

向前欧拉格式：

```matlab
function [x, result] = forward_euler(T, step, u0, f)
    x = linspace(0, T, step + 1);
    h = T / step;
    result = zeros(1, step + 1);
    result(1) = u0;
    for k = 2:step + 1
        result(k) = result(k - 1) + h * f(x(k - 1), result(k - 1));
    end
end
```

向后欧拉格式：

```matlab
function [x, result] = backward_euler(T, step, u0, f)
    x = linspace(0, T, step + 1);
    h = T / step;
    result = zeros(1, step + 1);
    result(1) = u0;
    for k = 2:step + 1
        temp_func = @(uk) result(k - 1) + h * f(x(k), uk) - uk;
        result(k) = fzero(temp_func, result(k - 1));
    end
end
```

跃点格式：

```matlab
function [x, result] = leap_frog(T, step, u0, u1, f)
    x = linspace(0, T, step + 1);
    h = T / step;
    result = zeros(1, step + 1);
    result(1) = u0;
    result(2) = u1;
    for k = 3:step + 1
        result(k) = result(k - 2) + 2 * h * f(x(k - 1), result(k - 1));
    end
end
```

梯形格式：

```matlab
function [x, result] = trapezoidal(T, step, u0, f)
    x = linspace(0, T, step + 1);
    h = T / step;
    result = zeros(1, step + 1);
    result(1) = u0;
    for k = 2:step + 1
        temp_func = @(uk) result(k - 1) - uk + ...
            h * (f(x(k), uk) + f(x(k - 1), result(k - 1))) / 2;
        result(k) = fzero(temp_func, result(k - 1));
    end
end
```

:::

考虑如下初值问题：

$$
 \begin{cases}u ^ { \prime } ( t ) = f ( t , u ( t ) ) = - \cos ( 5 \pi t ) \tan ( 5 \pi u ) , \\ u ( 0 ) = 1 / 6 0 .\end{cases}
$$

其解析解为：

$$
 u ( t ) = \frac { 1 } { 5 \pi } \arcsin \left( \frac { \sqrt { 6 } - \sqrt { 2 } } { 4 \exp ( \sin ( 5 \pi t ) ) } \right) .
$$

使用上述代码进行有限差分求解，得到数值结果如下：

![数值结果](https://bu.dusays.com/2024/10/28/671f2a82e022b.png)
